{\rtf1\ansi\ansicpg1252\cocoartf2578
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;\f1\fnil\fcharset0 HelveticaNeue-Medium;\f2\fnil\fcharset0 Menlo-Regular;
\f3\fnil\fcharset0 Menlo-Bold;\f4\fnil\fcharset0 HelveticaNeue-Italic;}
{\colortbl;\red255\green255\blue255;\red26\green26\blue26;\red255\green255\blue255;\red40\green88\blue220;
\red0\green0\blue0;\red14\green33\blue91;\red57\green63\blue69;\red246\green246\blue246;\red151\green0\blue255;
\red171\green48\blue53;\red83\green83\blue83;}
{\*\expandedcolortbl;;\cssrgb\c13333\c13333\c13333;\cssrgb\c100000\c100000\c100000;\cssrgb\c20000\c44314\c89020;
\cssrgb\c0\c0\c0\c5098;\cssrgb\c5882\c18824\c43137;\cssrgb\c28627\c31373\c34118;\cssrgb\c97255\c97255\c97255;\cssrgb\c66667\c13333\c100000;
\cssrgb\c73333\c26667\c26667;\cssrgb\c40000\c40000\c40000;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid101\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid201\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid401\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid501\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid6}
{\list\listtemplateid7\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid601\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid7}
{\list\listtemplateid8\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid8}
{\list\listtemplateid9\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid801\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid9}
{\list\listtemplateid10\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid901\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid10}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}{\listoverride\listid9\listoverridecount0\ls9}{\listoverride\listid10\listoverridecount0\ls10}}
\margl1440\margr1440\vieww23820\viewh13000\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs36 \cf0 Installing Kubernetes With KOPS\
\
\pard\pardeftab720\sl560\sa240\partightenfactor0
\cf2 \cb3 \expnd0\expndtw0\kerning0
Before you begin\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls1\ilvl0\cf2 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
You must have\'a0{\field{\*\fldinst{HYPERLINK "https://kubernetes.io/docs/tasks/tools/"}}{\fldrslt \cf4 kubectl}}\'a0installed.\cb1 \uc0\u8232 \
\ls1\ilvl0\cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
You must\'a0{\field{\*\fldinst{HYPERLINK "https://github.com/kubernetes/kops#installing"}}{\fldrslt \cf4 install}}\'a0\cb5 kops\cb3 \'a0on a 64-bit (AMD64 and Intel 64) device architecture.\cb1 \uc0\u8232 \
\ls1\ilvl0\cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
You must have an\'a0{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/polly/latest/dg/setting-up.html"}}{\fldrslt \cf4 AWS account}}, generate\'a0{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys"}}{\fldrslt \cf4 IAM keys}}\'a0and\'a0{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration"}}{\fldrslt \cf4 configure}}\'a0them. The IAM user will need\'a0{\field{\*\fldinst{HYPERLINK "https://github.com/kubernetes/kops/blob/master/docs/getting_started/aws.md#setup-iam-user"}}{\fldrslt \cf6 adequate permissions}}.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls1\ilvl0\cf2 \cb1 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\
\pard\pardeftab720\sl560\sa240\partightenfactor0
\ls1\ilvl0
\f1 \cf2 \cb3 \expnd0\expndtw0\kerning0
Creating a cluster\
\pard\pardeftab720\sl420\sa240\partightenfactor0
\ls1\ilvl0\cf2 (1/5) Install kops\
\pard\pardeftab720\sl380\sa240\partightenfactor0
\ls1\ilvl0\cf2 Installation\
\pard\pardeftab720\sa240\partightenfactor0
\ls1\ilvl0
\f0 \cf2 Download kops from the\'a0{\field{\*\fldinst{HYPERLINK "https://github.com/kubernetes/kops/releases"}}{\fldrslt \cf4 releases page}}\'a0(it is also convenient to build from source):\
\pard\tx220\tx720\pardeftab720\li720\fi-720\partightenfactor0
\ls1\ilvl0\cf7 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}{\field{\*\fldinst{HYPERLINK "https://kubernetes.io/docs/setup/production-environment/tools/kops/#kops-installation-0"}}{\fldrslt \expnd0\expndtw0\kerning0
macOS}}\cf2 \cb1 \expnd0\expndtw0\kerning0
\
\pard\tx720\pardeftab720\sa240\partightenfactor0
\cf2 \cb3 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\sa240\partightenfactor0
\ls2\ilvl0\cf2 \expnd0\expndtw0\kerning0
Download the latest release with the command:\cb1 \
\pard\pardeftab720\partightenfactor0
\ls2\ilvl0
\f2 \cf2 \cb8 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
curl -LO https://github.com/kubernetes/kops/releases/download/
\f3\b \cf9 $(
\f2\b0 \cf2 curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d \cf10 '"'\cf2  -f 4
\f3\b \cf9 )
\f2\b0 \cf2 /kops-darwin-amd64\
\pard\tx720\pardeftab720\partightenfactor0
\cf2 \
\
\pard\pardeftab720\sa240\partightenfactor0
\ls3\ilvl0
\f0 \cf2 \cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\
To download a specific version, replace the following portion of the command with the specific kops version.\cb1 \
\pard\pardeftab720\partightenfactor0
\ls3\ilvl0
\f3\b \cf9 \cb8 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
$(
\f2\b0 \cf2 curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d \cf10 '"'\cf2  -f 4
\f3\b \cf9 )\
\pard\tx720\pardeftab720\partightenfactor0

\f2\b0 \cf2 \
\pard\pardeftab720\sa240\partightenfactor0
\ls4\ilvl0
\f0 \cf2 \cb3 \
For example, to download kops version v1.20.0 type:\cb1 \
\pard\pardeftab720\partightenfactor0
\ls4\ilvl0
\f2 \cf2 \cb8 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
curl -LO https://github.com/kubernetes/kops/releases/download/v1.20.0/kops-darwin-amd64\
\pard\tx720\pardeftab720\partightenfactor0
\cf2 \
\pard\pardeftab720\sa240\partightenfactor0
\ls5\ilvl0
\f0 \cf2 \cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\
Make the kops binary executable.\cb1 \
\pard\pardeftab720\partightenfactor0
\ls5\ilvl0
\f2 \cf2 \cb8 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
chmod +x kops-darwin-amd64\
\pard\tx720\pardeftab720\partightenfactor0
\cf2 \
\pard\pardeftab720\sa240\partightenfactor0
\ls6\ilvl0
\f0 \cf2 \cb3 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\sa240\partightenfactor0
\ls6\ilvl0\cf2 \expnd0\expndtw0\kerning0
Move the kops binary in to your PATH.\cb1 \
\pard\pardeftab720\partightenfactor0
\ls6\ilvl0
\f2 \cf2 \cb8 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
sudo mv kops-darwin-amd64 /usr/local/bin/kops\
\ls6\ilvl0\kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
\
\pard\pardeftab720\sa240\partightenfactor0
\ls6\ilvl0
\f0 \cf2 \cb3 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\sa240\partightenfactor0
\ls6\ilvl0\cf2 \expnd0\expndtw0\kerning0
You can also install kops using\'a0{\field{\*\fldinst{HYPERLINK "https://brew.sh/"}}{\fldrslt \cf4 Homebrew}}.\cb1 \
\pard\pardeftab720\partightenfactor0
\ls6\ilvl0
\f2 \cf2 \cb8 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
brew update \cf11 &&\cf2  brew install kops\
\pard\tx720\pardeftab720\sl420\sa240\partightenfactor0

\f1 \cf2 \cb3 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\sl420\sa240\partightenfactor0
\ls7\ilvl0\cf2 \expnd0\expndtw0\kerning0
(2/5) Create a route53 domain for your cluster\
\pard\pardeftab720\sa240\partightenfactor0
\ls7\ilvl0
\f0 \cf2 \kerning1\expnd0\expndtw0 \
\pard\pardeftab720\sa240\partightenfactor0
\ls7\ilvl0\cf2 \expnd0\expndtw0\kerning0
kops uses DNS for discovery, both inside the cluster and outside, so that you can reach the kubernetes API server from clients.\
kops has a strong opinion on the cluster name: it should be a valid DNS name. By doing so you will no longer get your clusters confused, you can share 	clusters with your colleagues unambiguously, and you can reach them without relying on remembering an IP address.\
You can, and probably should, use subdomains to divide your clusters. As our example we will use\'a0
\f2 \cb5 useast1.dev.example.com
\f0 \cb3 . The API server endpoint will then be\'a0
\f2 \cb5 api.useast1.dev.example.com
\f0 \cb3 .\
A Route53 hosted zone can serve subdomains. Your hosted zone could be\'a0
\f2 \cb5 useast1.dev.example.com
\f0 \cb3 , but also\'a0
\f2 \cb5 dev.example.com
\f0 \cb3 \'a0or even\'a0
\f2 \cb5 example.com
\f0 \cb3 . kops works with any of these, so typically you choose for organization reasons (e.g. you are allowed to create records under\'a0
\f2 \cb5 dev.example.com
\f0 \cb3 , but not under\'a0
\f2 \cb5 example.com
\f0 \cb3 ).\
Let's assume you're using\'a0
\f2 \cb5 dev.example.com
\f0 \cb3 \'a0as your hosted zone. You create that hosted zone using the\'a0{\field{\*\fldinst{HYPERLINK "https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingNewSubdomain.html"}}{\fldrslt \cf4 normal process}}, or with a command such as\'a0
\f2 \cb5 aws route53 create-hosted-zone --name dev.example.com --caller-reference 1
\f0 \cb3 .\
You must then set up your NS records in the parent domain, so that records in the domain will resolve. Here, you would create NS records in\'a0
\f2 \cb5 example.com
\f0 \cb3 \'a0for\'a0
\f2 \cb5 dev
\f0 \cb3 . If it is a root domain name you would configure the NS records at your domain registrar (e.g.\'a0
\f2 \cb5 example.com
\f0 \cb3 \'a0would need to be configured where you bought\'a0
\f2 \cb5 example.com
\f0 \cb3 ).\
Verify your route53 domain setup (it is the #1 cause of problems!). You can double-check that your cluster is configured correctly if you have the dig tool by running:\
\pard\pardeftab720\sa240\partightenfactor0
\ls7\ilvl0
\f2 \cf2 \cb5 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
dig NS dev.example.com
\f0 \cb3 \
You should see the 4 NS records that Route53 assigned your hosted zone.\
\pard\pardeftab720\sl420\sa240\partightenfactor0

\f1 \cf2 \
(3/5) Create an S3 bucket to store your clusters state\
\pard\pardeftab720\sa240\partightenfactor0

\f0 \cf2 \
kops lets you manage your clusters even after installation. To do this, it must keep track of the clusters that you have created, along with their configuration, the keys they are using etc. This information is stored in an S3 bucket. S3 permissions are used to control access to the bucket.\
Multiple clusters can use the same S3 bucket, and you can share an S3 bucket between your colleagues that administer the same clusters - this is much easier than passing around kubecfg files. But anyone with access to the S3 bucket will have administrative access to all your clusters, so you don't want to share it beyond the operations team.\
So typically you have one S3 bucket for each ops team (and often the name will correspond to the name of the hosted zone above!)\
In our example, we chose\'a0
\f2 \cb5 dev.example.com
\f0 \cb3 \'a0as our hosted zone, so let's pick\'a0
\f2 \cb5 clusters.dev.example.com
\f0 \cb3 \'a0as the S3 bucket name.\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa240\partightenfactor0
\ls8\ilvl0\cf2 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
Export\'a0
\f2 \cb5 AWS_PROFILE
\f0 \cb3 \'a0(if you need to select a profile for the AWS CLI to work)\cb1 \uc0\u8232 \
\ls8\ilvl0\cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
Create the S3 bucket using\'a0
\f2 \cb5 aws s3 mb s3://clusters.dev.example.com
\f0 \cb1 \uc0\u8232 \
\ls8\ilvl0\cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
You can\'a0
\f2 \cb5 export KOPS_STATE_STORE=s3://clusters.dev.example.com
\f0 \cb3 \'a0and then kops will use this location by default. We suggest putting this in your bash profile or similar.\cb1 \uc0\u8232 \
\pard\pardeftab720\sl420\sa240\partightenfactor0

\f1 \cf2 \cb3 (4/5) Build your cluster configuration\
\
\pard\pardeftab720\sa240\partightenfactor0

\f0 \cf2 Run\'a0
\f2 \cb5 kops create cluster
\f0 \cb3 \'a0to create your cluster configuration:\

\f2 \cb5 kops create cluster --zones=us-east-1c useast1.dev.example.com
\f0 \cb3 \
kops will create the configuration for your cluster. Note that it\'a0
\f4\i only
\f0\i0 \'a0creates the configuration, it does not actually create the cloud resources - you'll do that in the next step with a\'a0
\f2 \cb5 kops update cluster
\f0 \cb3 . This give you an opportunity to review the configuration or change it.\
It prints commands you can use to explore further:\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa60\partightenfactor0
\ls9\ilvl0\cf2 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
List your clusters with:\'a0
\f2 \cb5 kops get cluster
\f0 \cb1 \
\ls9\ilvl0\cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
Edit this cluster with:\'a0
\f2 \cb5 kops edit cluster useast1.dev.example.com
\f0 \cb1 \
\ls9\ilvl0\cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
Edit your node instance group:\'a0
\f2 \cb5 kops edit ig --name=useast1.dev.example.com nodes
\f0 \cb1 \
\ls9\ilvl0\cb3 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
Edit your master instance group:\'a0
\f2 \cb5 kops edit ig --name=useast1.dev.example.com master-us-east-1c
\f0 \cb1 \
\pard\pardeftab720\sa240\partightenfactor0
\cf2 \cb3 If this is your first time using kops, do spend a few minutes to try those out! An instance group is a set of instances, which will be registered as kubernetes nodes. On AWS this is implemented via auto-scaling-groups. You can have several instance groups, for example if you wanted nodes that are a mix of spot and on-demand instances, or GPU and non-GPU instances.\
\pard\pardeftab720\sl420\sa240\partightenfactor0

\f1 \cf2 (5/5) Create the cluster in AWS\
\pard\pardeftab720\sa240\partightenfactor0

\f0 \cf2 Run "kops update cluster" to create your cluster in AWS:\

\f2 \cb5 kops update cluster useast1.dev.example.com --yes
\f0 \cb3 \
That takes a few seconds to run, but then your cluster will likely take a few minutes to actually be ready.\'a0
\f2 \cb5 kops update cluster
\f0 \cb3 \'a0will be the tool you'll use whenever you change the configuration of your cluster; it applies the changes you have made to the configuration to your cluster - reconfiguring AWS or kubernetes as needed.\
For example, after you\'a0
\f2 \cb5 kops edit ig nodes
\f0 \cb3 , then\'a0
\f2 \cb5 kops update cluster --yes
\f0 \cb3 \'a0to apply your configuration, and sometimes you will also have to\'a0
\f2 \cb5 kops rolling-update cluster
\f0 \cb3 \'a0to roll out the configuration immediately.\
Without\'a0
\f2 \cb5 --yes
\f0 \cb3 ,\'a0
\f2 \cb5 kops update cluster
\f0 \cb3 \'a0will show you a preview of what it is going to do. This is handy for production clusters!\
\
\pard\pardeftab720\sl560\sa240\partightenfactor0

\f1 \cf2 Cleanup\
\pard\tx220\tx720\pardeftab720\li720\fi-720\sa60\partightenfactor0
\ls10\ilvl0
\f0 \cf2 \kerning1\expnd0\expndtw0 {\listtext	\uc0\u8226 	}\expnd0\expndtw0\kerning0
To delete your cluster:\'a0
\f2 \cb5 kops delete cluster useast1.dev.example.com --yes\
\pard\tx720\pardeftab720\sa60\partightenfactor0

\f0\fs32 \cf2 \cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf2 \
\pard\tx720\pardeftab720\sa240\partightenfactor0

\fs28 \cf2 \
}
